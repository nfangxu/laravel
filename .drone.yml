kind: pipeline
type: kubernetes
name: default

metadata:
  namespace: default

trigger:
  branch:
  - master
  event:
  - push

steps:
# - name: install
#   image: registry.cn-beijing.aliyuncs.com/nfangxu/laranginx:1.1
#   commands:
#   - composer install
#   - cp .env.example .env
#   - php artisan key:generate

- name: publish
  image: plugins/docker
  settings:
    auto_tag: true
    repo: "registry-vpc.cn-beijing.aliyuncs.com/nfangxu/laravel"
    secrets: [ aliyun_username, aliyun_password ]

- name: deploy
  image: kubectl:v1.16.2
  commands:
  - kubectl delete -f deploy.yaml || true
  - kubectl apply -f deploy.yaml